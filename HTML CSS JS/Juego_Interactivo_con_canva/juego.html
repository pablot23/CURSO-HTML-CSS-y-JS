<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clasificación de Animales</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8f9fa;
      height: 100%;
      overflow-x: hidden;
    }

    * {
      box-sizing: border-box;
    }

    .game-wrapper {
      width: 100%;
      min-height: 100%;
      padding: 32px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-container {
      width: 100%;
      max-width: 1200px;
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .title {
      font-size: 32px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #2c3e50;
    }

    .instructions {
      font-size: 16px;
      color: #6c757d;
      margin: 0;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      margin: 24px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #4caf50;
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    .score {
      text-align: center;
      font-size: 18px;
      color: #495057;
      margin-bottom: 24px;
      font-weight: 500;
    }

    .animals-container {
      background: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .animals-title {
      font-size: 16px;
      font-weight: 600;
      color: #495057;
      margin: 0 0 16px 0;
      text-align: center;
    }

    .animals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      min-height: 80px;
    }

    .animal-item {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 16px 12px;
      text-align: center;
      cursor: grab;
      user-select: none;
      transition: all 0.2s ease;
      font-size: 15px;
      color: #495057;
      font-weight: 500;
    }

    .animal-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-color: #adb5bd;
    }

    .animal-item:active {
      cursor: grabbing;
    }

    .animal-item.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }

    .categories-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .category-box {
      background: white;
      border: 3px dashed #dee2e6;
      border-radius: 12px;
      padding: 20px;
      min-height: 240px;
      transition: all 0.2s ease;
    }

    .category-box.drag-over {
      border-color: #4caf50;
      background: #f1f8f4;
    }

    .category-title {
      font-size: 18px;
      font-weight: 600;
      color: #2c3e50;
      margin: 0 0 16px 0;
      text-align: center;
      padding-bottom: 12px;
      border-bottom: 2px solid #e9ecef;
    }

    .category-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 140px;
    }

    .category-item {
      background: #e8f5e9;
      border: 2px solid #4caf50;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      font-size: 15px;
      color: #2e7d32;
      font-weight: 500;
    }

    .feedback-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: white;
      padding: 32px 48px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      font-size: 24px;
      font-weight: 600;
      text-align: center;
      z-index: 1000;
      transition: transform 0.3s ease;
      min-width: 280px;
    }

    .feedback-message.show {
      transform: translate(-50%, -50%) scale(1);
    }

    .feedback-message.correct {
      color: #4caf50;
      border: 3px solid #4caf50;
    }

    .feedback-message.incorrect {
      color: #f44336;
      border: 3px solid #f44336;
    }

    .feedback-message.complete {
      color: #2196f3;
      border: 3px solid #2196f3;
    }

    .reset-button {
      display: block;
      margin: 0 auto;
      padding: 14px 32px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .reset-button:hover {
      background: #5a6268;
    }

    .reset-button:active {
      transform: scale(0.98);
    }

    @media (max-width: 768px) {
      .game-wrapper {
        padding: 20px 16px;
      }

      .title {
        font-size: 24px;
      }

      .categories-container {
        grid-template-columns: 1fr;
      }

      .animals-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="game-wrapper">
   <div class="game-container">
    <header class="header">
     <h1 class="title" id="gameTitle">Clasificación de Animales</h1>
     <p class="instructions" id="instructionsText">Arrastra cada animal a su categoría correcta</p>
    </header>
    <div class="progress-bar">
     <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="score" id="scoreDisplay">
     Clasificados correctamente: 0 de 6
    </div>
    <div class="animals-container">
     <h2 class="animals-title">Animales para clasificar</h2>
     <div class="animals-grid" id="animalsGrid"></div>
    </div>
    <div class="categories-container" id="categoriesContainer"></div><button class="reset-button" id="resetButton">Reiniciar Juego</button>
   </div>
  </div>
  <div class="feedback-message" id="feedbackMessage"></div>
  <script>
    const defaultConfig = {
      game_title: "Clasificación de Animales",
      instructions_text: "Arrastra cada animal a su categoría correcta",
      category_1: "Mamíferos",
      category_2: "Reptiles",
      category_3: "Anfibios",
      correct_message: "¡Correcto!",
      incorrect_message: "Intenta nuevamente",
      complete_message: "¡Excelente trabajo! Todos clasificados correctamente"
    };

    const animals = [
      { name: "León", category: "Mamíferos" },
      { name: "Delfín", category: "Mamíferos" },
      { name: "Serpiente", category: "Reptiles" },
      { name: "Cocodrilo", category: "Reptiles" },
      { name: "Rana", category: "Anfibios" },
      { name: "Salamandra", category: "Anfibios" }
    ];

    let gameState = {
      availableAnimals: [...animals],
      categorizedAnimals: {
        "Mamíferos": [],
        "Reptiles": [],
        "Anfibios": []
      },
      correctCount: 0
    };

    let draggedAnimal = null;

    function initializeGame() {
      renderAnimals();
      renderCategories();
      updateScore();
      updateProgress();
    }

    function renderAnimals() {
      const grid = document.getElementById('animalsGrid');
      grid.innerHTML = '';
      
      gameState.availableAnimals.forEach((animal, index) => {
        const animalDiv = document.createElement('div');
        animalDiv.className = 'animal-item';
        animalDiv.textContent = animal.name;
        animalDiv.draggable = true;
        animalDiv.dataset.index = index;
        
        animalDiv.addEventListener('dragstart', handleDragStart);
        animalDiv.addEventListener('dragend', handleDragEnd);
        
        grid.appendChild(animalDiv);
      });
    }

    function renderCategories() {
      const container = document.getElementById('categoriesContainer');
      const config = window.elementSdk?.config || defaultConfig;
      container.innerHTML = '';
      
      const categories = [config.category_1, config.category_2, config.category_3];
      
      categories.forEach(category => {
        const categoryBox = document.createElement('div');
        categoryBox.className = 'category-box';
        categoryBox.dataset.category = category;
        
        const title = document.createElement('h3');
        title.className = 'category-title';
        title.textContent = category;
        
        const itemsContainer = document.createElement('div');
        itemsContainer.className = 'category-items';
        
        categoryBox.appendChild(title);
        categoryBox.appendChild(itemsContainer);
        
        categoryBox.addEventListener('dragover', handleDragOver);
        categoryBox.addEventListener('dragleave', handleDragLeave);
        categoryBox.addEventListener('drop', handleDrop);
        
        container.appendChild(categoryBox);
      });
      
      updateCategoryContents();
    }

    function updateCategoryContents() {
      const config = window.elementSdk?.config || defaultConfig;
      const categories = [config.category_1, config.category_2, config.category_3];
      const originalCategories = ["Mamíferos", "Reptiles", "Anfibios"];
      
      categories.forEach((displayCategory, index) => {
        const originalCategory = originalCategories[index];
        const categoryBox = document.querySelector(`[data-category="${displayCategory}"]`);
        if (!categoryBox) return;
        
        const itemsContainer = categoryBox.querySelector('.category-items');
        itemsContainer.innerHTML = '';
        
        const items = gameState.categorizedAnimals[originalCategory] || [];
        items.forEach(animal => {
          const item = document.createElement('div');
          item.className = 'category-item';
          item.textContent = animal.name;
          itemsContainer.appendChild(item);
        });
      });
    }

    function handleDragStart(e) {
      const index = parseInt(e.target.dataset.index);
      draggedAnimal = gameState.availableAnimals[index];
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      e.currentTarget.classList.add('drag-over');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      
      if (!draggedAnimal) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      const droppedCategory = e.currentTarget.dataset.category;
      
      const categoryMap = {
        [config.category_1]: "Mamíferos",
        [config.category_2]: "Reptiles",
        [config.category_3]: "Anfibios"
      };
      
      const originalCategory = categoryMap[droppedCategory];
      const isCorrect = draggedAnimal.category === originalCategory;
      
      if (isCorrect) {
        showFeedback('correct', config.correct_message);
        gameState.categorizedAnimals[originalCategory].push(draggedAnimal);
        gameState.availableAnimals = gameState.availableAnimals.filter(a => a.name !== draggedAnimal.name);
        gameState.correctCount++;
        
        renderAnimals();
        updateCategoryContents();
        updateScore();
        updateProgress();
        
        if (gameState.correctCount === animals.length) {
          setTimeout(() => {
            showFeedback('complete', config.complete_message);
          }, 500);
        }
      } else {
        showFeedback('incorrect', config.incorrect_message);
      }
      
      draggedAnimal = null;
    }

    function showFeedback(type, message) {
      const feedbackDiv = document.getElementById('feedbackMessage');
      feedbackDiv.textContent = message;
      feedbackDiv.className = `feedback-message ${type} show`;
      
      setTimeout(() => {
        feedbackDiv.classList.remove('show');
      }, 1500);
    }

    function updateScore() {
      const scoreDisplay = document.getElementById('scoreDisplay');
      scoreDisplay.textContent = `Clasificados correctamente: ${gameState.correctCount} de ${animals.length}`;
    }

    function updateProgress() {
      const progressFill = document.getElementById('progressFill');
      const percentage = (gameState.correctCount / animals.length) * 100;
      progressFill.style.width = `${percentage}%`;
    }

    function resetGame() {
      gameState = {
        availableAnimals: [...animals],
        categorizedAnimals: {
          "Mamíferos": [],
          "Reptiles": [],
          "Anfibios": []
        },
        correctCount: 0
      };
      
      renderAnimals();
      updateCategoryContents();
      updateScore();
      updateProgress();
    }

    document.getElementById('resetButton').addEventListener('click', resetGame);

    async function onConfigChange(config) {
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('instructionsText').textContent = config.instructions_text || defaultConfig.instructions_text;
      
      const categoryBoxes = document.querySelectorAll('.category-box');
      const categories = [config.category_1, config.category_2, config.category_3];
      
      categoryBoxes.forEach((box, index) => {
        box.dataset.category = categories[index];
        const title = box.querySelector('.category-title');
        title.textContent = categories[index];
      });
    }

    const elementConfig = {
      defaultConfig: defaultConfig,
      onConfigChange: onConfigChange,
      mapToCapabilities: (config) => ({
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ["game_title", config.game_title || defaultConfig.game_title],
        ["instructions_text", config.instructions_text || defaultConfig.instructions_text],
        ["category_1", config.category_1 || defaultConfig.category_1],
        ["category_2", config.category_2 || defaultConfig.category_2],
        ["category_3", config.category_3 || defaultConfig.category_3],
        ["correct_message", config.correct_message || defaultConfig.correct_message],
        ["incorrect_message", config.incorrect_message || defaultConfig.incorrect_message],
        ["complete_message", config.complete_message || defaultConfig.complete_message]
      ])
    };

    if (window.elementSdk) {
      window.elementSdk.init(elementConfig);
    }

    initializeGame();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a5e1780923b9b24',t:'MTc2NDM3NzIyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>